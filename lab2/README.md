# Лабораторная работа 2

**Название:** "Разработка драйверов блочных устройств"

**Цель работы:** Получить знания и навыки разработки драйверов блочных устройств для операционной системы Linux.

## Описание функциональности драйвера

Драйвер создает виртуальный жесткий диск на 50 Мбайт и разбивает его на три первичных раздела по 10, 25 и 15 Мбайт соответственно.

## Инструкция по сборке

Запустить виртуальной машины с ядром нужной версии (4.15):

```sh
vagrant up
vagrant ssh
cd /vagrant
```

Собрать модуль драйвера:

```sh
make
```

## Инструкция пользователя

Установить модуль драйвера:

```sh
sudo insmod lab2.ko
```

Отформатировать разделы в FAT32:

```sh
for p in `seq 3`; do sudo mkfs -t vfat /dev/lbdv18p$p; done
```

## Примеры использования

Измерение скорости обмена данными:

```sh
for bs in 512 2048 4096 16384 65536; do
  for i in `seq 10`; do
    sudo dd if=/dev/vda1 of=/dev/lbdv18p2 bs=$bs count=$(( 15*1024*1024/$bs )) oflag=direct 2>&1 \
      | grep copied \
      | perl -ne 'if (/([0-9.]+) MB\/s/) { print "$1\n" } elsif (/([0-9.]+) GB\/s/) { print (($1*1024)."\n") }';
  done | awk '{ total += $1; count++ } END { print "block size '$bs': " count " runs " total/count " MB/s avg" }';
done
```

## Тестирование производительности
