# Лабораторная работа 1

**Название:** "Разработка драйверов символьных устройств"

**Цель работы:** Получить знания и навыки разработки драйверов символьных устройств для операционной системы Linux.

## Описание функциональности драйвера
При записи текста в файл символьного устройства драйвер запоминает количество пробелов в введенном тексте. При чтении файла /proc файла в консоль пользователя выводится последовательность полученных результатов с момента загрузки модуля ядра. Те же данные выводятся в кольцевой буфер при чтении из файла символьного устройства lab1_ch_dev. Имя /proc файла должно быть установлено с помощью ioctl команды.


## Инструкция по сборке

Для сборки драйвера необходимо ввести команду make.


## Инструкция пользователя

Для запуска драйвера необходимо ввести команду `sudo insmod lab1.ko && sudo chmod 0666 /dev/lab1_ch_dev`, которая загружает модуль ядра в систему и устанавливает необходимые права доступа.  
Для выгрузки модуля драйвера нужно ввести команду `sudo rmmod lab1`.

#### Использование клиента client.c
Первым аргументом нужно передать имя proc файла, из которого будет происходить чтение результатов. Так, если аргументом был `test`, то создастся файл `/proc/test`.  
Приложение будет считывать пользовательский ввод строка за строкой. Для завершения ввода необходимо нажать Ctrl+D. После этого произойдет вывод результатов, содержащий количество пробелов в каждой из введенных строк.

#### Написание собственного клиента
Для начала необходимо открыть файл драйвера символьного устройства.  
```C 
int fd = open("/dev/lab1_ch_dev", O_RDWR);
```  
После этого нужно сделать системный вызов `ioctl` и передать туда 0 вторым аргументом и название proc файла третьим.  
```C
ioctl(fd, 0, filename);
```  
Данные необходимо записывать в файл символьного устройства.  
```C
write(fd, buf, len);
```  
Читать результаты нужно из /proc файла  
```C
char fd_proc_name[512];
fd_proc_name[0] = '\0';
strcat(fd_proc_name, "/proc/");
strcat(fd_proc_name, filename);

int fd_proc = open(fd_proc_name, O_RDONLY);
read(fd_proc, buf, len);
```

## Примеры использования
```console
user@machine:~io-dt/lab1$ ./client test
hello
hello world
hello world world world world
^D
1) 0
2) 1
3) 4
user@machine:~io-dt/lab1$
```
